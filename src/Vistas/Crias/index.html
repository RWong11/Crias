<html lang="es">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../Contenido/css/bootstrap.min.css">
    <link rel="stylesheet" href="../Contenido/css/font-awesome.min.css">
    <link rel="stylesheet" href="../Contenido/css/vista.css">
    <link rel="stylesheet" href="../Contenido/css/sweetalert2.min.css">
    <link rel="stylesheet" href="../Contenido/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="../Contenido/css/buttons.bootstrap4.min.css">
    
    <script src="../Contenido/js/jquery-3.4.1.min.js"></script>
    <script src="../Contenido/js/jquery.dataTables.min.js"></script>
    <script src="../Contenido/js/dataTables.bootstrap4.min.js"></script>
    <script src="../Contenido/js/dataTables.buttons.min.js"></script>
    <script src="../Contenido/js/buttons.bootstrap4.min.js"></script>
    <script src="../Contenido/js/jszip.min.js"></script>
    <script src="../Contenido/js/pdfmake.min.js"></script>
    <script src="../Contenido/js/vfs_fonts.js"></script>
    <script src="../Contenido/js/buttons.html5.min.js"></script>
    <script src="../Contenido/js/buttons.print.min.js"></script>
    <script src="../Contenido/js/buttons.colVis.min.js"></script>
    <script src="../Contenido/js/popper.min.js"></script>
    <script src="../Contenido/js/bootstrap.min.js"></script>
    <script src="../Contenido/js/sweetalert2.min.js"></script>
    
    <style>
    td.details-control {
        background: url('../Contenido/images/details_open.png') no-repeat center center;
        cursor: pointer;
    }
    tr.shown td.details-control {
        background: url('../Contenido/images/details_close.png') no-repeat center center;
    }
	</style>
  </head>
  <body>
  <div class = "main">
    <h1 class="display-4" align="center">Crias</h1>
    <table id="tablaCrias" class="table table-striped table-bordered" style="width:100%;">
        <thead>
            <tr>
            	<th>+</th>
                <th>Clasificación</th>
                <th>Estado</th>
                <th>Corral</th>
                <th>Proceso actual</th>
                <th>Opciones</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th>+</th>
                <th>Clasificación</th>
                <th>Estado</th>
                <th>Corral</th>
                <th>Proceso actual</th>
                <th>Opciones</th>
            </tr>
        </tfoot>
    </table>
    </div>
  </body>
<script>
$( document ).ready(function() {
	var data = JSON.parse(window.java.cargarCrias());
	var table = $('#tablaCrias').DataTable( {
		"dom": 'Bfrtip',
		lengthChange: false,
        buttons: [ 
        	{
	        	extend: 'collection',
	        	text: 'Exportar',
	        	buttons: [
        		{
	                extend: 'copy',
	                text: 'Copiar',
	                exportOptions: {
	                    columns: ':visible'
	                }
	            },
	            {
	                extend: 'excel',
	                exportOptions: {
	                    columns: ':visible'
	                }
	            },
        		{
	                extend: 'pdf',
	                exportOptions: {
	                    columns: ':visible'
	                }
	            },	
	        	{
	                extend: 'print',
	                exportOptions: {
	                    columns: ':visible'
	                }
	            },
	            ]
			},
			'pageLength',
        	'colvis' 
       	],
       	"lengthMenu": [
            [ 10, 25, 50, -1 ],
            [ 'Ver 10', 'Ver 25', 'Ver 50', 'Ver Todos' ]
        ],
		"language": {
            "decimal":        "",
            "emptyTable":     "Sin registros",
            "info":           "Visualizando _START_ a _END_ de _TOTAL_ registros",
            "infoEmpty":      "Visualizando 0 a 0 de 0 registros",
            "infoFiltered":   "(filtrando de _MAX_ registros)",
            "infoPostFix":    "",
            "thousands":      ",",
            "lengthMenu":     "Visualizar _MENU_ registros por pagina",
            "loadingRecords": "Cargando...",
            "processing":     "Procesando...",
            "search":         "Buscar:",
            "zeroRecords":    "No se encontro ningun registro que coincida con su busqueda",
            "paginate": {
                "first":      "Primera",
                "last":       "Ultima",
                "next":       "Siguiente",
                "previous":   "Anterior"
            },
            "aria": {
                "sortAscending":  ": activar para ordenar ascendentemente",
                "sortDescending": ": activar para ordenar descendentemente"
            },
            "buttons": {
            	"colvis": "Columnas",
            	"print": "Imprimir",
            	"pageLength": {
                    _: "Visualizando %d registros por página",
                    '-1': "Visualizando todos"
                }
            }
            
        },
        "data": data,
        "columns": [
        	{
                "className": 'details-control',
                "orderable": false,
                "data": null,
                "defaultContent": ''
            },
            { "data": "cla_descripcion" },
            { "data": "est_descripcion" },
            { "data": "cor_descripcion" },
            { "data": null, render: function(data, type, row) {
                return "P" + data.proceso_actual;
            } },
            {
                data: null,
                orderable: false,
                className: "dt-center",
                defaultContent: "<button class='btn btn-warning'><i class='fa fa-edit'></i></button>&nbsp;<button class='btn btn-danger'><i class='fa fa-close'></i></button>"
            }
        ],
        "order": [[1, 'desc']]
    } );
	
	$('#tablaCrias tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row(tr);

        if (row.child.isShown()) {
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            row.child(formatInfo(row.data())).show();
            tr.addClass('shown');
        }
    });
});

function formatInfo(d) {
    var formato = '<ul class="list-group list-group-horizontal-sm">' +
                  '<li class="list-group-item"><b>Peso:</b> ' + d.cri_peso +'</li>' +
                  '<li class="list-group-item"><b>Cantidad de Grasa:</b> ' + d.cri_grasa + '</li>' +
                  '<li class="list-group-item"><b>Color del Musculo:</b> ' + d.col_descripcion + '</li></ul>';

    return formato;
}
</script>
</html>
